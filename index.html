<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tech Spotter</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and Babel for running React in the browser -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
        /* CORRECTED: @import rule must be at the top */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .bg-gradient-primary {
            background-image: linear-gradient(to right, #2563eb, #3b82f6);
        }
        .shadow-glow {
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const TechResults = ({ results, url }) => {
            if (!results || !results.detected_technologies) return null;
            
            const { detected_technologies } = results;
            const allTechs = Object.values(detected_technologies).flat();

            return (
                <div className="py-10 md:py-20 bg-slate-50">
                    <div className="container mx-auto px-4">
                        <div className="max-w-6xl mx-auto">
                            <div className="text-center mb-12">
                                <h2 className="text-3xl md:text-4xl font-bold text-gray-800 mb-4">
                                    Analysis Results for <span className="text-blue-600">{url}</span>
                                </h2>
                                <p className="text-gray-500 text-lg">
                                    {results.message} Found {allTechs.length} technologies.
                                </p>
                            </div>

                            <div className="space-y-8">
                                {Object.entries(detected_technologies).map(([category, techs]) => {
                                    if (techs.length === 0) return null;
                                    return (
                                        <div key={category} className="p-6 bg-white rounded-xl border border-slate-200 shadow-sm">
                                            <h3 className="text-xl font-semibold mb-4 capitalize flex items-center gap-2 text-gray-800">
                                                {category} ({techs.length})
                                            </h3>
                                            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                                                {techs.map((tech, index) => (
                                                    <div key={index} className="flex items-center justify-between p-4 bg-slate-50 rounded-lg border border-slate-200">
                                                        <div className="font-medium text-gray-700">{tech.name}</div>
                                                        <span className="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">{tech.detected}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [url, setUrl] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [results, setResults] = useState(null);
            const [error, setError] = useState('');

            const realApiCall = async (analysisUrl) => {
                const backendUrl = "https://tech-spotter-api.onrender.com/analyze";
                const response = await fetch(backendUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: analysisUrl })
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Analysis failed!');
                }
                return response.json();
            };

            const handleAnalyze = async (e) => {
                e.preventDefault();
                console.log("Analyze button clicked! Starting analysis..."); // Debugging line

                if (!url) {
                    setError('Please enter a valid website URL.');
                    return;
                }
                
                setIsLoading(true);
                setResults(null);
                setError('');

                try {
                    const data = await realApiCall(url);
                    setResults(data);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 text-gray-800">
                    <header className="py-20">
                        <div className="container mx-auto px-4 text-center">
                            <h1 className="text-4xl md:text-6xl font-extrabold mb-4">Tech Spotter</h1>
                            <p className="text-lg md:text-xl text-gray-500 max-w-3xl mx-auto">
                                Discover the technology stack behind any website. Analyze GTM, GA4, frameworks, and more in seconds.
                            </p>
                            
                            <form onSubmit={handleAnalyze} className="mt-10 max-w-2xl mx-auto">
                                <div className="flex items-center p-2 border-2 border-blue-200 rounded-lg bg-white shadow-lg focus-within:border-blue-500 transition-all">
                                    <span className="mx-3 text-gray-400">üåê</span>
                                    <input
                                        type="text"
                                        value={url}
                                        onChange={(e) => setUrl(e.target.value)}
                                        placeholder="Enter website URL (e.g., https://example.com)"
                                        className="w-full p-2 text-lg bg-transparent focus:outline-none"
                                    />
                                    <button 
                                        type="submit" 
                                        disabled={isLoading}
                                        className="ml-2 px-6 py-3 bg-gradient-primary text-white font-semibold rounded-lg hover:shadow-glow transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                                    >
                                        {isLoading ? 'Analyzing...' : 'Analyze Site'}
                                    </button>
                                </div>
                                {error && <p className="text-red-500 mt-2">{error}</p>}
                            </form>
                        </div>
                    </header>
                    
                    <main>
                        {isLoading && (
                            <div className="flex justify-center items-center py-10">
                                <div className="loader"></div>
                            </div>
                        )}
                        
                        {results && <TechResults results={results} url={url} />}
                    </main>
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
