<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tech Spotter - Website Technology Checker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .bg-gradient-primary { background-image: linear-gradient(to right, #2563eb, #3b82f6); }
        .shadow-glow { box-shadow: 0 0 25px rgba(59, 130, 246, 0.3); }
        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const HeroSection = ({ handleAnalyze, url, setUrl, isLoading, error }) => (
            <header className="py-20 md:py-32 bg-white">
                <div className="container mx-auto px-4 text-center">
                    <h1 className="text-4xl md:text-6xl font-extrabold mb-4 text-gray-900">Instantly Uncover the Tech Behind Any Website</h1>
                    <p className="text-lg md:text-xl text-gray-500 max-w-3xl mx-auto">
                        Analyze GTM, GA4, frameworks, compliance, and more in seconds. Free, fast, and no registration required.
                    </p>
                    <form onSubmit={handleAnalyze} className="mt-10 max-w-2xl mx-auto">
                        <div className="flex items-center p-2 border-2 border-slate-200 rounded-lg bg-white shadow-lg focus-within:border-blue-500 transition-all">
                            <span className="mx-3 text-gray-400">üåê</span>
                            <input
                                type="text"
                                value={url}
                                onChange={(e) => setUrl(e.target.value)}
                                placeholder="Enter full URL (e.g., https://example.com)"
                                className="w-full p-2 text-lg bg-transparent focus:outline-none"
                            />
                            <button 
                                type="submit" 
                                disabled={isLoading}
                                className="ml-2 px-6 py-3 bg-gradient-primary text-white font-semibold rounded-lg hover:shadow-glow transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                            >
                                {isLoading ? 'Analyzing...' : 'Analyze Site'}
                            </button>
                        </div>
                        {error && <p className="text-red-500 mt-2">{error}</p>}
                    </form>
                </div>
            </header>
        );

        const TechResults = ({ results, url }) => {
            if (!results || !results.detected_technologies) return null;
            
            const { detected_technologies } = results;
            const allTechs = Object.values(detected_technologies).flat();

            const formatCategoryName = (name) => name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());

            return (
                <div className="py-10 md:py-20 bg-slate-50" id="results">
                    <div className="container mx-auto px-4">
                        <div className="max-w-6xl mx-auto">
                            <div className="text-center mb-12">
                                <h2 className="text-3xl md:text-4xl font-bold text-gray-800 mb-4">
                                    Analysis Results for <a href={url} target="_blank" className="text-blue-600 underline">{url}</a>
                                </h2>
                                <p className="text-gray-500 text-lg">
                                    {results.message} Found {allTechs.length} technologies across {Object.keys(detected_technologies).length} categories.
                                </p>
                            </div>
                            <div className="space-y-8">
                                {Object.entries(detected_technologies).map(([category, techs]) => {
                                    if (techs.length === 0) return null;
                                    return (
                                        <div key={category} className="p-6 bg-white rounded-xl border border-slate-200 shadow-sm">
                                            <h3 className="text-xl font-semibold mb-4 capitalize flex items-center gap-2 text-gray-800">
                                                {formatCategoryName(category)} ({techs.length})
                                            </h3>
                                            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                                                {techs.map((tech, index) => (
                                                    <div key={index} className="p-4 bg-slate-50 rounded-lg border border-slate-200">
                                                        <div className="flex items-center justify-between">
                                                            <span className="font-medium text-gray-700">{tech.name}</span>
                                                            <span className="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">Detected</span>
                                                        </div>
                                                        {tech.ids && (
                                                            <div className="mt-2 pt-2 border-t border-slate-200 space-y-1">
                                                                {tech.ids.map(id => <div key={id} className="text-sm text-gray-500 font-mono bg-slate-200 px-2 py-1 rounded w-full truncate">{id}</div>)}
                                                            </div>
                                                        )}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        const LoadingAnimation = () => {
            const [progress, setProgress] = useState(10);
            const [text, setText] = useState("Initializing analysis...");
            const loadingStates = [
                { percent: 25, text: "Fetching URL..." },
                { percent: 50, text: "Parsing HTML content..." },
                { percent: 75, text: "Analyzing scripts & tags..." },
                { percent: 100, text: "Finalizing report..." },
            ];

            useEffect(() => {
                const interval = setInterval(() => {
                    const currentStateIndex = loadingStates.findIndex(s => s.percent > progress);
                    if (currentStateIndex !== -1) {
                        const nextState = loadingStates[currentStateIndex];
                        setProgress(nextState.percent);
                        setText(nextState.text);
                    } else {
                        clearInterval(interval);
                    }
                }, 1200); // ~5 seconds total animation
                return () => clearInterval(interval);
            }, [progress]);

            return (
                <div className="py-20">
                    <div className="max-w-2xl mx-auto text-center">
                        <h3 className="text-xl font-semibold text-gray-800 mb-4">{text}</h3>
                        <div className="w-full bg-slate-200 rounded-full h-4">
                            <div className="bg-blue-600 h-4 rounded-full progress-bar-fill" style={{ width: `${progress}%` }}></div>
                        </div>
                    </div>
                </div>
            );
        };
        
        const App = () => {
            const [url, setUrl] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [results, setResults] = useState(null);
            const [error, setError] = useState('');

            const realApiCall = async (analysisUrl) => {
                const backendUrl = "https://tech-spotter-api.onrender.com/analyze";
                const response = await fetch(backendUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: analysisUrl })
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Analysis failed!');
                }
                return response.json();
            };

            const handleAnalyze = async (e) => {
                e.preventDefault();
                if (!url) { setError('Please enter a valid website URL.'); return; }
                
                setIsLoading(true);
                setResults(null);
                setError('');

                try {
                    const data = await realApiCall(url);
                    setResults(data);
                    setTimeout(() => {
                        const resultsEl = document.getElementById('results');
                        if (resultsEl) { resultsEl.scrollIntoView({ behavior: 'smooth' }); }
                    }, 100);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 text-gray-800">
                    <HeroSection handleAnalyze={handleAnalyze} url={url} setUrl={setUrl} isLoading={isLoading} error={error} />
                    <main>
                        {isLoading && <LoadingAnimation />}
                        {results && <TechResults results={results} url={url} />}
                    </main>
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
