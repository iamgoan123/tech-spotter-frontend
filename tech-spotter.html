<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tech Spotter</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and Babel for running React in the browser -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons for React -->
    <script src="https://cdn.jsdelivr.net/npm/lucide-react@0.292.0/dist/lucide-react.js"></script>
    <style>
        /* Custom styles for the glass effect and theme */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Light gray background */
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');
        .bg-glass-bg {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
        }
        .border-glass-border {
            border-color: rgba(203, 213, 225, 0.5);
        }
        .bg-gradient-primary {
            background-image: linear-gradient(to right, #2563eb, #3b82f6);
        }
        .shadow-glow {
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Deconstruct necessary components from the global 'LucideReact' object
        const { ExternalLink, Code, BarChart3, Shield, Palette, CheckCircle, AlertTriangle, Globe, Search, Zap } = LucideReact;
        const { useState } = React;

        // --- MOCK DATA & HELPERS (FROM YOUR ORIGINAL CODE) ---
        // This is the placeholder data. In a real app, your backend API would generate this.
        const mockResults = {
          analytics: [
            { name: "Google Analytics 4", version: "gtag.js", detected: true, category: "Analytics" },
            { name: "Google Tag Manager", version: "GTM-XXXXXXX", detected: true, category: "Analytics" },
          ],
          frameworks: [
            { name: "React", version: "18.3.1", detected: true, category: "Framework" },
            { name: "Vite", version: "5.x", detected: true, category: "Build Tool" },
            { name: "Tailwind CSS", version: "3.x", detected: true, category: "CSS Framework" },
          ],
          security: [
            { name: "SSL Certificate", version: "TLS 1.3", detected: true, category: "Security" },
            { name: "HSTS", version: "enabled", detected: true, category: "Security" },
          ],
          compliance: [
            { name: "OneTrust", version: "6.34.0", detected: true, category: "Consent Management", region: "Global" },
            { name: "GDPR Compliance", version: "required", detected: true, category: "Privacy Law", region: "EU", flag: "ðŸ‡ªðŸ‡º" },
            { name: "CCPA Compliance", version: "required", detected: true, category: "Privacy Law", region: "California", flag: "ðŸ‡ºðŸ‡¸" },
            { name: "Cookie Banner", version: "custom", detected: true, category: "Consent UI", region: "Global" },
          ]
        };

        const getCategoryIcon = (category) => {
          switch (category.toLowerCase()) {
            case 'analytics': return <BarChart3 className="w-5 h-5 text-blue-500" />;
            case 'framework':
            case 'build tool': return <Code className="w-5 h-5 text-green-500" />;
            case 'css framework': return <Palette className="w-5 h-5 text-pink-500" />;
            case 'security': return <Shield className="w-5 h-5 text-indigo-500" />;
            case 'consent management':
            case 'consent ui': return <CheckCircle className="w-5 h-5 text-teal-500" />;
            case 'privacy law': return <AlertTriangle className="w-5 h-5 text-orange-500" />;
            default: return <Code className="w-5 h-5 text-gray-500" />;
          }
        };
        
        // --- UI COMPONENTS ---

        // This is your original TechResults component, now adapted to accept `results` and `url` as props
        const TechResults = ({ results, url }) => {
            if (!results) return null;

            const allTechs = Object.values(results).flat();
            const detectedTechs = allTechs.filter(tech => tech.detected);
            const categories = [...new Set(allTechs.map(tech => tech.category))];
            const complianceDetected = results.compliance.filter(tech => tech.detected);

            return (
                <div className="py-10 md:py-20 bg-slate-50">
                    <div className="container mx-auto px-4">
                        <div className="max-w-6xl mx-auto">
                            <div className="text-center mb-12">
                                <h2 className="text-3xl md:text-4xl font-bold text-gray-800 mb-4">
                                    Analysis Results for <span className="text-blue-600">{url}</span>
                                </h2>
                                <p className="text-gray-500 text-lg">
                                    Found {detectedTechs.length} technologies across {categories.length} categories
                                </p>
                            </div>

                            <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-12">
                                {[
                                    { label: "Total Found", value: detectedTechs.length },
                                    { label: "Analytics", value: results.analytics.filter(t => t.detected).length },
                                    { label: "Frameworks", value: results.frameworks.filter(t => t.detected).length },
                                    { label: "Security", value: results.security.filter(t => t.detected).length },
                                    { label: "Compliance", value: complianceDetected.length }
                                ].map((stat, index) => (
                                    <div key={index} className="p-6 text-center bg-white rounded-xl border border-slate-200 shadow-sm">
                                        <div className="text-3xl font-bold text-blue-600 mb-2">{stat.value}</div>
                                        <div className="text-sm text-gray-500">{stat.label}</div>
                                    </div>
                                ))}
                            </div>
                            
                            {complianceDetected.length > 0 && (
                               <div className="p-6 mb-8 bg-white rounded-xl border border-slate-200 shadow-sm">
                                    <h3 className="text-xl font-semibold mb-4 flex items-center gap-2 text-gray-800">
                                        <Globe className="w-6 h-6" /> Privacy & Compliance Overview
                                    </h3>
                                    <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        {complianceDetected.map((compliance, index) => (
                                            <div key={index} className="flex items-center justify-between p-4 bg-slate-50 rounded-lg border border-slate-200">
                                                <div className="flex items-center gap-3">
                                                    <div className="flex items-center gap-2">
                                                        {compliance.flag && <span className="text-lg">{compliance.flag}</span>}
                                                        {getCategoryIcon(compliance.category)}
                                                    </div>
                                                    <div>
                                                        <div className="font-medium text-gray-700">{compliance.name}</div>
                                                        <div className="text-sm text-gray-500">{compliance.region} â€¢ {compliance.version}</div>
                                                    </div>
                                                </div>
                                                <span className={`px-2 py-1 text-xs font-medium rounded-full ${compliance.category.toLowerCase() === 'privacy law' ? 'bg-orange-100 text-orange-800' : 'bg-green-100 text-green-800'}`}>
                                                    {compliance.category.toLowerCase() === 'privacy law' ? 'Required' : 'Active'}
                                                </span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            <div className="space-y-8">
                                {Object.entries(results).map(([category, techs]) => {
                                    const detectedInCategory = techs.filter(tech => tech.detected);
                                    if (detectedInCategory.length === 0 || category === 'compliance') return null;

                                    return (
                                        <div key={category} className="p-6 bg-white rounded-xl border border-slate-200 shadow-sm">
                                            <h3 className="text-xl font-semibold mb-4 capitalize flex items-center gap-2 text-gray-800">
                                                {getCategoryIcon(category)} {category} ({detectedInCategory.length})
                                            </h3>
                                            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                                                {detectedInCategory.map((tech, index) => (
                                                    <div key={index} className="flex items-center justify-between p-4 bg-slate-50 rounded-lg border border-slate-200">
                                                        <div className="flex items-center gap-3">
                                                            {getCategoryIcon(tech.category)}
                                                            <div>
                                                                <div className="font-medium text-gray-700">{tech.name}</div>
                                                                <div className="text-sm text-gray-500">{tech.version}</div>
                                                            </div>
                                                        </div>
                                                        <span className="px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800">Detected</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP COMPONENT ---
        const App = () => {
            // State to manage the application's data and UI
            const [url, setUrl] useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [results, setResults] = useState(null);
            const [error, setError] = useState('');

            /**
             * THIS IS A FAKE API CALL.
             * In a real application, this function would make a `fetch` request to your backend server.
             * The backend server would then perform the actual website scraping and analysis.
             * For demonstration, this function just waits for 2 seconds and returns the mock data.
             */
            const fakeApiCall = (analysisUrl) => {
                console.log(`Analyzing ${analysisUrl}...`);
                return new Promise((resolve) => {
                    setTimeout(() => {
                        // Here, you could modify the mockResults based on the URL if you wanted.
                        // For now, we just return the same data every time.
                        resolve(mockResults);
                    }, 2000);
                });
            };
            
            /*
            // This is what a REAL API call would look like:
            const realApiCall = async (analysisUrl) => {
                const response = await fetch('https://your-backend-api.com/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: analysisUrl })
                });
                if (!response.ok) {
                    throw new Error('Analysis failed!');
                }
                return response.json();
            };
            */


            const handleAnalyze = async (e) => {
                e.preventDefault();
                if (!url) {
                    setError('Please enter a valid website URL.');
                    return;
                }
                
                // Reset state for a new analysis
                setIsLoading(true);
                setResults(null);
                setError('');

                try {
                    // Replace `fakeApiCall` with `realApiCall` when you have a backend
                    const data = await fakeApiCall(url);
                    setResults(data);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 text-gray-800">
                    <header className="py-20">
                        <div className="container mx-auto px-4 text-center">
                            <h1 className="text-4xl md:text-6xl font-extrabold mb-4">Tech Spotter</h1>
                            <p className="text-lg md:text-xl text-gray-500 max-w-3xl mx-auto">
                                Discover the technology stack behind any website. Analyze GTM, GA4, frameworks, and more in seconds.
                            </p>
                            
                            <form onSubmit={handleAnalyze} className="mt-10 max-w-2xl mx-auto">
                                <div className="flex items-center p-2 border-2 border-blue-200 rounded-lg bg-white shadow-lg focus-within:border-blue-500 transition-all">
                                    <Search className="w-6 h-6 text-gray-400 mx-3" />
                                    <input
                                        type="text"
                                        value={url}
                                        onChange={(e) => setUrl(e.target.value)}
                                        placeholder="Enter website URL (e.g., https://example.com)"
                                        className="w-full p-2 text-lg bg-transparent focus:outline-none"
                                    />
                                    <button 
                                        type="submit" 
                                        disabled={isLoading}
                                        className="ml-2 px-6 py-3 bg-gradient-primary text-white font-semibold rounded-lg hover:shadow-glow transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                                    >
                                        {isLoading ? 'Analyzing...' : 'Analyze Site'}
                                    </button>
                                </div>
                                {error && <p className="text-red-500 mt-2">{error}</p>}
                            </form>
                        </div>
                    </header>
                    
                    <main>
                        {isLoading && (
                            <div className="flex justify-center items-center py-10">
                                <div className="loader"></div>
                            </div>
                        )}
                        
                        {results && <TechResults results={results} url={url} />}
                    </main>
                </div>
            );
        };

        // Render the main App component to the DOM
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
